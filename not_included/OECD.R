


aus <- stan_io <- OECD::get_dataset (
  "IOTS",
  filter = io_sdmx ,
  pre_formatted = TRUE
)

io_sdmx <- "https://stats.oecd.org/restsdmx/sdmx.ashx/GetData/IOTS/TTL.AUS.TTL_C01T05+TTL_C10T14+TTL_C15T16+TTL_C17T19+TTL_C20+TTL_C21T22+TTL_C23+TTL_C24+TTL_C25+TTL_C26+TTL_C27+TTL_C28+TTL_C29+TTL_C30T33X+TTL_C31+TTL_C34+TTL_C35+TTL_C36T37+TTL_C40T41+TTL_C45+TTL_C50T52+TTL_C55+TTL_C60T63+TTL_C64+TTL_C65T67+TTL_C70+TTL_C71+TTL_C72+TTL_C73T74+TTL_C75+TTL_C80+TTL_C85+TTL_C90T93+TTL_C95+DOM_C01T05+DOM_C10T14+DOM_C15T16+DOM_C17T19+DOM_C20+DOM_C21T22+DOM_C23+DOM_C24+DOM_C25+DOM_C26+DOM_C27+DOM_C28+DOM_C29+DOM_C30T33X+DOM_C31+DOM_C34+DOM_C35+DOM_C36T37+DOM_C40T41+DOM_C45+DOM_C50T52+DOM_C55+DOM_C60T63+DOM_C64+DOM_C65T67+DOM_C70+DOM_C71+DOM_C72+DOM_C73T74+DOM_C75+DOM_C80+DOM_C85+DOM_C90T93+DOM_C95+IMP_C01T05+IMP_C10T14+IMP_C15T16+IMP_C17T19+IMP_C20+IMP_C21T22+IMP_C23+IMP_C24+IMP_C25+IMP_C26+IMP_C27+IMP_C28+IMP_C29+IMP_C30T33X+IMP_C31+IMP_C34+IMP_C35+IMP_C36T37+IMP_C40T41+IMP_C45+IMP_C50T52+IMP_C55+IMP_C60T63+IMP_C64+IMP_C65T67+IMP_C70+IMP_C71+IMP_C72+IMP_C73T74+IMP_C75+IMP_C80+IMP_C85+IMP_C90T93+IMP_C95+TXS_INT_FNL+TTL_INT_FNL+VALU+LABR+OTXS+GOPS+CFC+NOPS+OUTPUT+TOTAL+CTOTAL+DISC.C01T05+C10T14+C15T16+C17T19+C20+C21T22+C23+C24+C25+C26+C27+C28+C29+C30T33X+C31+C34+C35+C36T37+C40T41+C45+C50T52+C55+C60T63+C64+C65T67+C70+C71+C72+C73T74+C75+C80+C85+C90T93+C95+HFCE+NPISH+GGFC+GFCF+INVNT+CONS_ABR+CONS_NONRES+EXPO+IMPO+ICESHR/all?startTime=1995&endTime=2011"

sdmx <- readSDMX(file = "https://stats.oecd.org/restsdmx/sdmx.ashx/GetData/IOTS/TTL+DOMIMP+VAL+LEONTFT+LEONTFD+ICESHR.AUS.TTL_C01T05+TTL_C10T14+TTL_C15T16+TTL_C17T19+TTL_C20+TTL_C21T22+TTL_C23+TTL_C24+TTL_C25+TTL_C26+TTL_C27+TTL_C28+TTL_C29+TTL_C30T33X+TTL_C31+TTL_C34+TTL_C35+TTL_C36T37+TTL_C40T41+TTL_C45+TTL_C50T52+TTL_C55+TTL_C60T63+TTL_C64+TTL_C65T67+TTL_C70+TTL_C71+TTL_C72+TTL_C73T74+TTL_C75+TTL_C80+TTL_C85+TTL_C90T93+TTL_C95+DOM_C01T05+DOM_C10T14+DOM_C15T16+DOM_C17T19+DOM_C20+DOM_C21T22+DOM_C23+DOM_C24+DOM_C25+DOM_C26+DOM_C27+DOM_C28+DOM_C29+DOM_C30T33X+DOM_C31+DOM_C34+DOM_C35+DOM_C36T37+DOM_C40T41+DOM_C45+DOM_C50T52+DOM_C55+DOM_C60T63+DOM_C64+DOM_C65T67+DOM_C70+DOM_C71+DOM_C72+DOM_C73T74+DOM_C75+DOM_C80+DOM_C85+DOM_C90T93+DOM_C95+IMP_C01T05+IMP_C10T14+IMP_C15T16+IMP_C17T19+IMP_C20+IMP_C21T22+IMP_C23+IMP_C24+IMP_C25+IMP_C26+IMP_C27+IMP_C28+IMP_C29+IMP_C30T33X+IMP_C31+IMP_C34+IMP_C35+IMP_C36T37+IMP_C40T41+IMP_C45+IMP_C50T52+IMP_C55+IMP_C60T63+IMP_C64+IMP_C65T67+IMP_C70+IMP_C71+IMP_C72+IMP_C73T74+IMP_C75+IMP_C80+IMP_C85+IMP_C90T93+IMP_C95+TXS_INT_FNL+TTL_INT_FNL+VALU+LABR+OTXS+GOPS+CFC+NOPS+OUTPUT+TOTAL+CTOTAL+DISC.C01T05+C10T14+C15T16+C17T19+C20+C21T22+C23+C24+C25+C26+C27+C28+C29+C30T33X+C31+C34+C35+C36T37+C40T41+C45+C50T52+C55+C60T63+C64+C65T67+C70+C71+C72+C73T74+C75+C80+C85+C90T93+C95+HFCE+NPISH+GGFC+GFCF+INVNT+CONS_ABR+CONS_NONRES+EXPO+IMPO+ICESHR/all?startTime=1995&endTime=2011")

stan_io <- OECD::get_dataset ("IOTS")

providers <- getSDMXServiceProviders()
providers <- as.data.frame(providers)
stan_io <- read.csv("C:/Users/Daniel Antal/OneDrive - Visegrad Investments/2017 Projektek/CEEMID_Import/_imported/oecd/IOTS_18102017163915949.csv")
library (dplyr)

sdmx_io <- readSDMX(providerId = "OECD", providerKey = NULL resource = "data", flowRef="IOTS", key = "all", key.mode = "SDMX", start = 2010, end = 2011)

small_stan <- stan_io %>%
  sample_n ( 1000)

View ( small_stan )  

sdmx <- readSDMX(providerId = "OECD", resource = "data", flowRef = "MIG",
                 key = list("TOT", NULL, NULL), start = 2011, end = 2011)
stats <- as.data.frame(sdmx)
z <- sdmx

sdmx.data <- readSDMX(providerId = "OECD", resource = "data", flowRef = "MIG",
                      key = list("TOT", NULL, NULL), start = 2010, end = 2011)
sdmx.dsd <- readSDMX(providerId = "OECD", resource = "datastructure", resourceId = "MIG")
sdmx.data <- setDSD(sdmx.data, sdmx.dsd)
unique ( stan_io$Country)


library(XML2R)

file <- "https://stats.oecd.org/restsdmx/sdmx.ashx/GetData/IOTS/TTL.AUS.TTL_C01T05+TTL_C10T14+TTL_C15T16+TTL_C17T19+TTL_C20+TTL_C21T22+TTL_C23+TTL_C24+TTL_C25+TTL_C26+TTL_C27+TTL_C28+TTL_C29+TTL_C30T33X+TTL_C31+TTL_C34+TTL_C35+TTL_C36T37+TTL_C40T41+TTL_C45+TTL_C50T52+TTL_C55+TTL_C60T63+TTL_C64+TTL_C65T67+TTL_C70+TTL_C71+TTL_C72+TTL_C73T74+TTL_C75+TTL_C80+TTL_C85+TTL_C90T93+TTL_C95+DOM_C01T05+DOM_C10T14+DOM_C15T16+DOM_C17T19+DOM_C20+DOM_C21T22+DOM_C23+DOM_C24+DOM_C25+DOM_C26+DOM_C27+DOM_C28+DOM_C29+DOM_C30T33X+DOM_C31+DOM_C34+DOM_C35+DOM_C36T37+DOM_C40T41+DOM_C45+DOM_C50T52+DOM_C55+DOM_C60T63+DOM_C64+DOM_C65T67+DOM_C70+DOM_C71+DOM_C72+DOM_C73T74+DOM_C75+DOM_C80+DOM_C85+DOM_C90T93+DOM_C95+IMP_C01T05+IMP_C10T14+IMP_C15T16+IMP_C17T19+IMP_C20+IMP_C21T22+IMP_C23+IMP_C24+IMP_C25+IMP_C26+IMP_C27+IMP_C28+IMP_C29+IMP_C30T33X+IMP_C31+IMP_C34+IMP_C35+IMP_C36T37+IMP_C40T41+IMP_C45+IMP_C50T52+IMP_C55+IMP_C60T63+IMP_C64+IMP_C65T67+IMP_C70+IMP_C71+IMP_C72+IMP_C73T74+IMP_C75+IMP_C80+IMP_C85+IMP_C90T93+IMP_C95+TXS_INT_FNL+TTL_INT_FNL+VALU+LABR+OTXS+GOPS+CFC+NOPS+OUTPUT+TOTAL+CTOTAL+DISC.C01T05+C10T14+C15T16+C17T19+C20+C21T22+C23+C24+C25+C26+C27+C28+C29+C30T33X+C31+C34+C35+C36T37+C40T41+C45+C50T52+C55+C60T63+C64+C65T67+C70+C71+C72+C73T74+C75+C80+C85+C90T93+C95+HFCE+NPISH+GGFC+GFCF+INVNT+CONS_ABR+CONS_NONRES+EXPO+IMPO+ICESHR/all?startTime=1995&endTime=2011"

obs <- XML2Obs(file)
tables <- collapse_obs(obs)

# The data we care about is stored in the following three nodes
# We only care about the country variable in the keys node
keys <- tables[["MessageGroup//DataSet//Series//SeriesKey//Value"]]
dates <- tables[["MessageGroup//DataSet//Series//Obs//Time"]]
values <- tables[["MessageGroup//DataSet//Series//Obs//ObsValue"]]

# Extract the country part of the keys table
# Have to use both COU and COUNTRY as OECD don't use a standard name
country_list <- keys[keys[,1]== "COU" | keys[,1]== "COUNTRY"]
# The country names are stored in the middle third of the above list
country_list <- country_list[(length(country_list)*1/3+1):(length(country_list)*2/3)]

# Bind the existing date and value vectors
dat <- cbind.data.frame(as.numeric(dates[,1]),as.numeric(values[,1]))
colnames(dat) <- c('date', 'value')

# Add the country variable
# This code maps a new country each time the diff(dat$date)<=0 ...
# ...as there are a different number of readings for each country
# This is not particularly robust
dat$country <- c(country_list[1], country_list[cumsum(diff(dat$date) <= 0) + 1])
#created this as too many sig figs make the rChart ugly
dat$value2 <- signif(dat$value,2)

head(dat)

result2 = getTimeSeries('OECD', 'IOTS/LEONTFD.CHE.DOM_C65T67.')
result = getTimeSeries('OECD', my_url_short, start = 2008, end = 2011)
result2 <- getSDMX('OECD', my_url_short, start = 2008, end = 2011)

my_url = 'IOTS/TTL.AUS.TTL_C01T05+TTL_C10T14+TTL_C15T16+TTL_C17T19+TTL_C20+TTL_C21T22+TTL_C23+TTL_C24+TTL_C25+TTL_C26+TTL_C27+TTL_C28+TTL_C29+TTL_C30T33X+TTL_C31+TTL_C34+TTL_C35+TTL_C36T37+TTL_C40T41+TTL_C45+TTL_C50T52+TTL_C55+TTL_C60T63+TTL_C64+TTL_C65T67+TTL_C70+TTL_C71+TTL_C72+TTL_C73T74+TTL_C75+TTL_C80+TTL_C85+TTL_C90T93+TTL_C95+DOM_C01T05+DOM_C10T14+DOM_C15T16+DOM_C17T19+DOM_C20+DOM_C21T22+DOM_C23+DOM_C24+DOM_C25+DOM_C26+DOM_C27+DOM_C28+DOM_C29+DOM_C30T33X+DOM_C31+DOM_C34+DOM_C35+DOM_C36T37+DOM_C40T41+DOM_C45+DOM_C50T52+DOM_C55+DOM_C60T63+DOM_C64+DOM_C65T67+DOM_C70+DOM_C71+DOM_C72+DOM_C73T74+DOM_C75+DOM_C80+DOM_C85+DOM_C90T93+DOM_C95+IMP_C01T05+IMP_C10T14+IMP_C15T16+IMP_C17T19+IMP_C20+IMP_C21T22+IMP_C23+IMP_C24+IMP_C25+IMP_C26+IMP_C27+IMP_C28+IMP_C29+IMP_C30T33X+IMP_C31+IMP_C34+IMP_C35+IMP_C36T37+IMP_C40T41+IMP_C45+IMP_C50T52+IMP_C55+IMP_C60T63+IMP_C64+IMP_C65T67+IMP_C70+IMP_C71+IMP_C72+IMP_C73T74+IMP_C75+IMP_C80+IMP_C85+IMP_C90T93+IMP_C95+TXS_INT_FNL+TTL_INT_FNL+VALU+LABR+OTXS+GOPS+CFC+NOPS+OUTPUT+TOTAL+CTOTAL+DISC.C01T05+C10T14+C15T16+C17T19+C20+C21T22+C23+C24+C25+C26+C27+C28+C29+C30T33X+C31+C34+C35+C36T37+C40T41+C45+C50T52+C55+C60T63+C64+C65T67+C70+C71+C72+C73T74+C75+C80+C85+C90T93+C95+HFCE+NPISH+GGFC+GFCF+INVNT+CONS_ABR+CONS_NONRES+EXPO+IMPO+ICESHR/all?startTime=1995&endTime=2011'


my_url_short = "IOTS/TTL.AUS.TTL_C01T05+TTL_C10T14+TTL_C15T16+TTL_C17T19+TTL_C20+TTL_C21T22+TTL_C23+TTL_C24+TTL_C25+TTL_C26+TTL_C27+TTL_C28+TTL_C29+TTL_C30T33X+TTL_C31+TTL_C34+TTL_C35+TTL_C36T37+TTL_C40T41+TTL_C45+TTL_C50T52+TTL_C55+TTL_C60T63+TTL_C64+TTL_C65T67+TTL_C70+TTL_C71+TTL_C72+TTL_C73T74+TTL_C75+TTL_C80+TTL_C85+TTL_C90T93+TTL_C95+DOM_C01T05+DOM_C10T14+DOM_C15T16+DOM_C17T19+DOM_C20+DOM_C21T22+DOM_C23+DOM_C24+DOM_C25+DOM_C26+DOM_C27+DOM_C28+DOM_C29+DOM_C30T33X+DOM_C31+DOM_C34+DOM_C35+DOM_C36T37+DOM_C40T41+DOM_C45+DOM_C50T52+DOM_C55+DOM_C60T63+DOM_C64+DOM_C65T67+DOM_C70+DOM_C71+DOM_C72+DOM_C73T74+DOM_C75+DOM_C80+DOM_C85+DOM_C90T93+DOM_C95+IMP_C01T05+IMP_C10T14+IMP_C15T16+IMP_C17T19+IMP_C20+IMP_C21T22+IMP_C23+IMP_C24+IMP_C25+IMP_C26+IMP_C27+IMP_C28+IMP_C29+IMP_C30T33X+IMP_C31+IMP_C34+IMP_C35+IMP_C36T37+IMP_C40T41+IMP_C45+IMP_C50T52+IMP_C55+IMP_C60T63+IMP_C64+IMP_C65T67+IMP_C70+IMP_C71+IMP_C72+IMP_C73T74+IMP_C75+IMP_C80+IMP_C85+IMP_C90T93+IMP_C95+TXS_INT_FNL+TTL_INT_FNL+VALU+LABR+OTXS+GOPS+CFC+NOPS+OUTPUT+TOTAL+CTOTAL+DISC.C01T05+C10T14+C15T16+C17T19+C20+C21T22+C23+C24+C25+C26+C27+C28+C29+C30T33X+C31+C34+C35+C36T37+C40T41+C45+C50T52+C55+C60T63+C64+C65T67+C70+C71+C72+C73T74+C75+C80+C85+C90T93+C95+HFCE+NPISH+GGFC+GFCF+INVNT+CONS_ABR+CONS_NONRES+EXPO+IMPO+ICESHR"
